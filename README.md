# A/B Test Monte Carlo Simulator for AI App

AI 앱의 멤버십 상품 구성 변경이 매출에 미치는 영향을 분석하기 위한 Monte Carlo 시뮬레이션 및 베이지안 분석 도구입니다.

## 📋 프로젝트 개요

이 프로젝트는 멤버십 상품 구성 변경에 대한 A/B 테스트를 시뮬레이션하고, Frequentist와 Bayesian 두 가지 통계적 접근법으로 결과를 분석합니다. Monte Carlo 시뮬레이션(1,000회 반복)을 통해 불확실성을 정량화하고 의사결정을 지원합니다.

### 주요 기능

- 📊 **사용자 행동 데이터 시뮬레이션**: 가입, 설문 응답, 결제 패턴 생성
- 🔬 **A/B 테스트 그룹 자동 배정**: 6월 가입자를 대상으로 무작위 배정
- 💰 **다차원 지표 분석**: CVR, ARPU, ARPPU, 총 매출
- 📈 **Monte Carlo 시뮬레이션**: 1,000회 반복을 통한 결과 분포 추정
- 🎲 **베이지안 분석**: 사후 확률 분포 및 신뢰구간 계산
- 📊 **시각화**: 분포 비교 및 불확실성 시각화
- 📁 **테스트 데이터 생성**: 실제 분석 가능한 CSV 데이터 출력

## 🎯 A/B 테스트 설계

### Type 20 (대조군 - Control)
**상품 구성**:
- 일주일 멤버십: 30,000원 (60%)
- 한달 멤버십: 100,000원 (40%)
- AI 추천권: 5,000원 (일주일 멤버십 구매자의 70%가 추가 구매)

**예상 성과**:
- 전환율(CVR): ~30%
- 전략: 저가 상품으로 진입장벽을 낮추고 추가 상품 판매

### Type 21 (실험군 - Treatment)
**상품 구성**:
- 일주일 멤버십: 30,000원 (20%)
- 한달 멤버십: 100,000원 (80%)
- AI 추천권: 없음

**예상 성과**:
- 전환율(CVR): ~20%
- 전략: 고가 멤버십 집중으로 ARPPU 증대

## 📊 측정 지표

| 지표 | 설명 | 계산식 |
|------|------|--------|
| **CVR** | 전환율 | (결제 유저 수 / 전체 유저 수) × 100 |
| **ARPU** | 유저당 평균 매출 | 총 매출 / 전체 유저 수 |
| **ARPPU** | 결제 유저당 평균 매출 | 총 매출 / 결제 유저 수 |
| **Total Revenue** | 총 매출 | 모든 결제 금액의 합 |
| **Total Orders** | 총 주문 건수 | 모든 주문 수의 합 |

## 🚀 시작하기

### 필요 라이브러리
```bash
pip install pandas numpy matplotlib scipy
```

### 실행 방법
```bash
# Monte Carlo 시뮬레이션 실행
python mcmc.py

# 데이터 검증 (선택사항)
python check.py
```

### 출력 파일

실행 완료 시 `dataSave/` 폴더에 다음 파일들이 생성됩니다:

```
dataSave/
├── users.csv                          # 전체 사용자 정보 (1,700명)
├── ab_tests.csv                       # A/B 테스트 배정 (6월 가입자 600명)
├── answers.csv                        # 설문 응답 데이터
├── payments.csv                       # 결제 데이터
├── monte_carlo_results.csv            # 1,000회 시뮬레이션 결과
├── monte_carlo_visualization.png      # 매출 분포 박스플롯
└── bayesian_analysis.png              # 베이지안 분석 시각화
```

## 📊 시뮬레이션 파라미터

### 사용자 설정
- **총 사용자**: 1,700명 (5월~10월, 6개월간)
  - 5월: 300명
  - 6월: 600명 (A/B 테스트 대상)
  - 7월~10월: 각 200명
- **성별 분포**:
  - 남성: 66.7% (평균 출생년도: 1995년)
  - 여성: 33.3% (평균 출생년도: 1998년)

### 가격 정책
- AI 추천권: 5,000원
- 일주일 멤버십: 30,000원
- 한달 멤버십: 100,000원

### 재구매율
- 월별 재구매율: 50%
- 매월 기존 결제 유저의 절반이 재구매

## 📈 시뮬레이션 결과 (실제 출력 기준)

### Monte Carlo 평균 결과 (1,000회 시뮬레이션)

```
=== 매출 비교 ===
Type 20 (대조군): 9,328,525원
Type 21 (실험군): 8,156,920원
매출 차이: 1,171,605원 (14.4%)

Type 20이 더 높을 확률: 76.1%
95% 신뢰구간: [-2,400,125원, 4,475,250원]

=== 전환율 비교 ===
Type 20 CVR: 29.96%
Type 21 CVR: 20.02%
CVR 차이: 9.94%p

Type 20이 더 높을 확률: 99.7%
95% 신뢰구간: [3.39%, 16.82%]

=== ARPPU 비교 ===
Type 20 ARPPU: 103,886원
Type 21 ARPPU: 135,606원
ARPPU 차이: 31,720원 (30.5%)

Type 21이 더 높을 확률: 99.0%
95% 신뢰구간: [5,628원, 59,168원]

=== ARPU 비교 ===
Type 20 ARPU: 31,124원
Type 21 ARPU: 27,164원
ARPU 차이: 3,960원
```

### 통계적 검정 결과

**Frequentist 접근 (t-test)**:
| 지표 | Type 20 우위 | p-value | 유의성 |
|------|------------|---------|--------|
| CVR | ✓ | < 0.001 | 유의함 |
| Total Revenue | ✓ | < 0.001 | 유의함 |
| ARPU | ✓ | < 0.001 | 유의함 |
| ARPPU | Type 21 우위 | < 0.001 | 유의함 |

**Bayesian 접근**:
- Type 20 매출 우위 확률: **76.1%**
- Type 20이 5% 이상 높을 확률: **68.4%**
- Type 20이 10% 이상 높을 확률: **59.7%**
- Type 21 ARPPU 우위 확률: **99.0%**

## 🔍 주요 인사이트

### 1. **전환율 트레이드오프**
- Type 20: 낮은 가격 → 높은 전환율 (30%)
- Type 21: 높은 가격 → 낮은 전환율 (20%)
- **CVR 차이가 통계적으로 매우 유의함** (p < 0.001)

### 2. **매출 최적화**
- Type 20이 **76.1% 확률로 더 높은 매출** 생성
- 평균 매출 차이: 약 117만원 (14.4%)
- 그러나 95% 신뢰구간이 0을 포함하여 불확실성 존재

### 3. **고객 가치 분석**
- **ARPPU**: Type 21이 31.7만원 더 높음 (30.5% 증가)
  - 결제 고객의 질은 Type 21이 우수
- **ARPU**: Type 20이 3,960원 더 높음
  - 전체 사용자 기준으로는 Type 20이 효율적

### 4. **상품 전략**
- **Type 20의 AI 추천권이 중요한 역할**
  - 일주일 멤버십 구매자의 70%가 추가 구매
  - 총 주문 수 증가에 기여
- **Type 21의 한달 멤버십 집중 전략**
  - 전환율은 낮지만 건당 매출이 높음

### 5. **불확실성 고려**
- 매출 차이의 95% 신뢰구간이 넓음
- 실제 비즈니스에서는 더 많은 샘플이 필요할 수 있음

## 📁 데이터 스키마

### users.csv
| 컬럼 | 타입 | 설명 | 예시 |
|------|------|------|------|
| timestamp | datetime | 가입 시간 | 2025-05-21 03:01:00 |
| id | string | 사용자 ID | 2025-05_user_1 |
| gender | string | 성별 | M/F |
| birth | int | 출생년도 | 1995 |
| signup_month | string | 가입 월 | 2025-06 |

### ab_tests.csv (6월 가입자만)
| 컬럼 | 타입 | 설명 | 예시 |
|------|------|------|------|
| timestamp | datetime | 배정 시간 | 2025-06-25 17:24:00 |
| user_id | string | 사용자 ID | 2025-06_user_1 |
| type | int | 테스트 타입 | 20 또는 21 |

### answers.csv
| 컬럼 | 타입 | 설명 | 예시 |
|------|------|------|------|
| created | datetime | 응답 시간 | 2025-05-21 23:01:00 |
| answer_id | int | 질문 번호 | 1~5 |
| user_id | string | 사용자 ID | 2025-05_user_1 |
| answer | int | 응답 값 | 1 또는 2 |

### payments.csv
| 컬럼 | 타입 | 설명 | 예시 |
|------|------|------|------|
| created | datetime | 결제 시간 | 2025-05-24 21:37:00 |
| user_id | string | 사용자 ID | 2025-05_user_1 |
| order_name | string | 상품명 | ai 추천권/일주일 멤버십/한달 멤버십 |
| amount | int | 결제 금액 | 5000/30000/100000 |
| cancel | int | 취소 여부 | 0 (정상) / 1 (취소) |

## 🛠️ 커스터마이징

시뮬레이션 파라미터는 `mcmc.py` 상단에서 수정 가능합니다:

```python
# Monte Carlo 시뮬레이션 횟수
N_SIMULATIONS = 1000

# 전환율 설정
CONVERSION_RATE_TYPE20 = 0.30  # Type 20 전환율
CONVERSION_RATE_TYPE21 = 0.20  # Type 21 전환율

# Type 21 멤버십 분포
MEMBERSHIP_DIST_TYPE21 = {
    'weekly': 0.20,   # 일주일 멤버십 비율
    'monthly': 0.80   # 한달 멤버십 비율
}

# Type 20 멤버십 분포
MEMBERSHIP_DIST_TYPE20 = {
    'weekly': 0.60,   # 일주일 멤버십 비율
    'monthly': 0.40   # 한달 멤버십 비율
}

# AI 추천권 추가 구매 비율 (Type 20만)
AI_ADDON_RATE = 0.70  # 일주일 멤버십 구매자 중 70%

# 재구매율
REPURCHASE_RATE = 0.50  # 월별 50%
```

## ✅ 데이터 검증

생성된 데이터의 무결성을 확인하려면:
```bash
python check.py
```

검증 항목:
- ✓ Type별 유저 수 확인
- ✓ CVR, ARPU, ARPPU 계산 검증
- ✓ 주문 타입별 분포 확인
- ✓ 6월 가입자만 A/B 테스트에 포함되었는지 확인
- ✓ 총 매출 및 주문 건수 일치 여부

## 🎓 분석 방법론

### Frequentist 접근
- **t-검정**으로 그룹 간 차이의 통계적 유의성 검정
- p-value < 0.05 기준으로 유의성 판단
- 귀무가설: 두 그룹 간 차이가 없음

### Bayesian 접근
- **사후 확률 분포** 계산
- 95% **신뢰구간(Credible Interval)** 제공
- "Type 20이 더 나을 확률"을 직접 계산
- 의사결정에 더 직관적인 정보 제공

### Monte Carlo 시뮬레이션
- 1,000회 반복 시뮬레이션
- 각 시뮬레이션마다 독립적인 사용자 행동 생성
- 결과의 불확실성과 변동성 정량화
- 평균, 중앙값, 신뢰구간 계산

## 💡 실무 활용 권장사항

### Type 20 선택을 고려할 경우
- ✓ **단기 매출 최대화**가 목표
- ✓ 신규 사용자 **유입이 중요**
- ✓ **전환율 개선**이 핵심 KPI
- ✓ 추가 상품 판매 기회 활용 가능

### Type 21 선택을 고려할 경우
- ✓ **프리미엄 포지셔닝** 전략
- ✓ **고객 생애 가치(LTV)** 중시
- ✓ 높은 **ARPPU 목표**
- ✓ 운영 단순화 필요 (AI 추천권 관리 불필요)

### 추가 테스트 권장사항
- 실제 환경에서 더 많은 샘플로 검증 필요
- 장기적인 재구매율 및 이탈률 모니터링
- 사용자 세그먼트별 선호도 분석
- 계절성 및 마케팅 효과 고려

## 📚 참고 자료

- [A/B Testing Best Practices](https://www.optimizely.com/optimization-glossary/ab-testing/)
- [Bayesian Methods for Hackers](https://github.com/CamDavidsonPilon/Probabilistic-Programming-and-Bayesian-Methods-for-Hackers)
- [Statistical Power and Sample Size](https://www.statsmodels.org/stable/stats.html#power-and-sample-size-calculations)

## 👤 작성자

Marvin

## 📝 라이선스

이 프로젝트는 교육 및 분석 목적으로 제작되었습니다.

## 🙏 기여

이슈나 풀 리퀘스트는 언제나 환영합니다!

---

**마지막 업데이트**: 2025-12-01  
**버전**: 2.0.0
